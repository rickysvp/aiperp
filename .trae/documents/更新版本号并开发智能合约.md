## 第一阶段：版本更新与推送

### 1. 更新版本号
- **package.json**: 1.2.0 → 1.3.0
- **VersionInfo.tsx**: v1.1.0 → v1.3.0，更新 buildDate
- **LanguageContext.tsx**: nav_subtitle "AI Perp Predict Clash" → "v1.3.0"

### 2. 创建更新记录
创建 `CHANGELOG.md` 记录版本变更

### 3. 提交并推送
```bash
git add -A
git commit -m "chore: bump version to 1.3.0
- Update package.json version
- Update VersionInfo component
- Change nav subtitle to version number
- Add CHANGELOG.md"
git push origin main
```

---

## 第二阶段：智能合约开发（按文档要求）

### 当前合约状态
已存在基础合约结构：
- `AIperpArena.sol` - 主竞技场合约
- `AgentNFT.sol` - Agent NFT 合约
- `MockUSDT.sol` - 测试 USDT
- `PriceOracle.sol` - 价格预言机
- `BattleLogic.sol` - 战斗逻辑库

### 需要完善的功能（按文档7步流程）

#### 第1步：核心数据结构 ✅（已有基础）
- 已有: Direction 枚举, Agent 结构体
- 需添加: Faction 枚举 (ALLIANCE/SYNDICATE), AgentState 结构体

#### 第2步：用户操作函数
- `mintAgent(leverageLimit)` - 铸造 Agent
- `deposit(agentId, amount)` - 充值 USDT
- `withdraw(agentId, amount)` - 提现
- `chooseFaction(agentId, faction, multiplier)` - 选择阵营

#### 第3步：阵营管理逻辑
- 添加阵营追踪变量: allianceUnits, allianceStake, syndicateUnits, syndicateStake
- 阵营 Agent 列表管理

#### 第4步：价格喂价与结算
- `pushPriceAndSettle(newPrice)` - Oracle 喂价触发结算
- Tick 逻辑实现

#### 第5步：PVP 结算逻辑（最复杂）
- `_settleTick()` - 结算逻辑
- 赢家掠夺输家资金
- 手续费扣除 (2%)
- 爆仓检查

#### 第6步：查询函数
- `getAllianceStats()` - 返回 (units, stake)
- `getSyndicateStats()` - 返回 (units, stake)
- `getBTCPrice()` - 返回当前价格
- `getAgent(agentId)` - 返回 Agent 状态

#### 第7步：权限与风控
- onlyOwner, onlyOracle 修饰器
- 暂停机制
- 费率设置 (2%)

### 测试要求
- 每个函数必须有3类测试：正常流程、边界情况、权限控制
- 覆盖率：核心函数 100%
- Foundry 测试语法

### 前端对接
1. 导出 ABI 到前端
2. 更新环境变量
3. 6大核心流程测试：铸造/充值/选阵营/结算/查询/提现

---

## 时间估算
- 版本更新：10分钟
- 合约开发：2-3小时
- 测试编写：1-2小时
- 前端对接：1小时
- 总计：4-6小时

请确认后开始执行。